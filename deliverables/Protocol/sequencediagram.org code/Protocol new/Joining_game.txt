title Joining game

participant Client1
participant Client2
participant Client3
participant Server

note over Client1, Server: Client1 connecting

Server->Client1: ConnectedMessage()
Server->Client1: ChooseUsernameMessage()

loop do while the username is invalid
	Client1->Server: UsernameChoiceMessage(username)
    alt Invalid username
      Server->Client1: InvalidUsernameMessage(InvalidFormat, AlreadyTaken)    
      else Valid username
      Server->Client1: AckMessage()
    end
end


Server->Client1: ChooseGameSettingMessage()
loop do while game settings are invalid

Client1->Server: GameSettingsMessage(GameSettings)

alt Invalid settings
Server->Client1: InvalidGameSettingsMessage()
else Valid settings
Server->Client1: AckMessage()
Server->Client1: GameJoinedMessage(PlayerUsernames, GameSettings)
end

end
space 
note over Client2, Server: Client2 connecting
Server->Client2: ConnectedMessage()
Server->Client2: ChooseUsernameMessage()
Client2-->Server: UsernameChoiceMessage(username)
note over Client2, Server: Username is assumed valid
Server-->Client2: GameJoinedMessage(PlayerUsernames, GameSettings)

Server->>Client1: NewPlayerJoinedMessage(PlayerUsernames)

space 
note over Client3, Server: Client3 connecting
Server->Client3: ConnectedMessage()
Server->Client3: ChooseUsernameMessage()
Client3-->Server: UsernameChoiceMessage(username)
note over Client3, Server: Username is assumed valid
Server-->Client3: GameJoinedMessage(PlayerUsernames, GameSettings)

Server->>Client1: NewPlayerJoinedMessage(PlayerUsernames)
Server->>Client2: NewPlayerJoinedMessage(PlayerUsernames)



space 

note over Client1, Server: Starting game

Server ->Server: Initialize the game
Server ->>Client1: StartingGameMessage(Usernames, GameSettings, Update)
Server ->>Client2: StartingGameMessage(Usernames, GameSettings, Update)
Server ->>Client3: StartingGameMessage(Usernames, GameSettings, Update)